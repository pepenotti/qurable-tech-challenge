<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="863px" preserveAspectRatio="none" style="width:728px;height:863px;background:#FEFEFE;" version="1.1" viewBox="0 0 728 863" width="728px" zoomAndPan="magnify"><title>Upload Custom Code List (High-Level)</title><defs/><g><rect fill="#FEFEFE" height="863" style="stroke:none;stroke-width:1;" width="728" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="277.6279" x="226.4561" y="28.5352">Upload Custom Code List (High-Level)</text><g><title>API</title><rect fill="#FFFFFF" height="494.8555" style="stroke:#181818;stroke-width:1;" width="10" x="305.1016" y="165.5977"/></g><g><title>Database</title><rect fill="#FFFFFF" height="405.9238" style="stroke:#181818;stroke-width:1;" width="10" x="484.958" y="194.9082"/></g><rect fill="none" height="275.3711" style="stroke:#000000;stroke-width:1.5;" width="711.54" x="10" y="378.082"/><g><title>Admin</title><rect fill="#000000" fill-opacity="0.00000" height="663.3398" width="8" x="41.1382" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="45" x2="45" y1="118.9766" y2="782.3164"/></g><g><title>API</title><rect fill="#000000" fill-opacity="0.00000" height="663.3398" width="8" x="306.1016" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="309.3862" x2="309.3862" y1="118.9766" y2="782.3164"/></g><g><title>Database</title><rect fill="#000000" fill-opacity="0.00000" height="663.3398" width="8" x="485.958" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="489.6255" x2="489.6255" y1="118.9766" y2="782.3164"/></g><g class="participant participant-head" data-participant="Admin"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.2764" x="20" y="116.0234">Admin</text><ellipse cx="45.1382" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M45.1382,58.9883 L45.1382,85.9883 M32.1382,66.9883 L58.1382,66.9883 M45.1382,85.9883 L32.1382,100.9883 M45.1382,85.9883 L58.1382,100.9883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Admin"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.2764" x="20" y="794.8516">Admin</text><ellipse cx="45.1382" cy="806.3047" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M45.1382,814.3047 L45.1382,841.3047 M32.1382,822.3047 L58.1382,822.3047 M45.1382,841.3047 L32.1382,856.3047 M45.1382,841.3047 L58.1382,856.3047" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="API"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="35.4307" x="292.3862" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21.4307" x="299.3862" y="108.0234">API</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="35.4307" x="292.3862" y="781.3164"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21.4307" x="299.3862" y="801.8516">API</text></g><g class="participant participant-head" data-participant="DB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.665" x="455.6255" y="116.0234">Database</text><path d="M471.958,66.4883 C471.958,56.4883 489.958,56.4883 489.958,56.4883 C489.958,56.4883 507.958,56.4883 507.958,66.4883 L507.958,92.4883 C507.958,102.4883 489.958,102.4883 489.958,102.4883 C489.958,102.4883 471.958,102.4883 471.958,92.4883 L471.958,66.4883" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M471.958,66.4883 C471.958,76.4883 489.958,76.4883 489.958,76.4883 C489.958,76.4883 507.958,76.4883 507.958,66.4883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="DB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.665" x="455.6255" y="794.8516">Database</text><path d="M471.958,807.8047 C471.958,797.8047 489.958,797.8047 489.958,797.8047 C489.958,797.8047 507.958,797.8047 507.958,807.8047 L507.958,833.8047 C507.958,843.8047 489.958,843.8047 489.958,843.8047 C489.958,843.8047 471.958,843.8047 471.958,833.8047 L471.958,807.8047" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M471.958,807.8047 C471.958,817.8047 489.958,817.8047 489.958,817.8047 C489.958,817.8047 507.958,817.8047 507.958,807.8047" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g><title>API</title><rect fill="#FFFFFF" height="494.8555" style="stroke:#181818;stroke-width:1;" width="10" x="305.1016" y="165.5977"/></g><g><title>Database</title><rect fill="#FFFFFF" height="405.9238" style="stroke:#181818;stroke-width:1;" width="10" x="484.958" y="194.9082"/></g><g class="message" data-participant-1="Admin" data-participant-2="API"><polygon fill="#181818" points="293.1016,161.5977,303.1016,165.5977,293.1016,169.5977,297.1016,165.5977" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="45.1382" x2="299.1016" y1="165.5977" y2="165.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.9634" x="54.6382" y="145.5449">POST /books/{book_id}/codes/upload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.2437" x="75.998" y="160.8555">{codes: ["CODE1", "CODE2", ...]}</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="472.958,190.9082,482.958,194.9082,472.958,198.9082,476.958,194.9082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="478.958" y1="194.9082" y2="194.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.0278" x="333.5159" y="190.166">BEGIN TRANSACTION</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="472.958,238.5293,482.958,242.5293,472.958,246.5293,476.958,242.5293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="478.958" y1="242.5293" y2="242.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81.104" x="359.4778" y="222.4766">SELECT book</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85.6235" x="357.218" y="237.7871">FOR UPDATE</text></g><path d="M499,207.9082 L499,247.9082 L653,247.9082 L653,217.9082 L643,207.9082 L499,207.9082" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M643,207.9082 L643,217.9082 L653,217.9082 L643,207.9082" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.7578" x="505" y="225.4766">Lock book to prevent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.3447" x="505" y="240.7871">concurrent uploads</text><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#181818" points="326.1016,270.8398,316.1016,274.8398,326.1016,278.8398,322.1016,274.8398" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="320.1016" x2="483.958" y1="274.8398" y2="274.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.0396" x="357.51" y="270.0977">Book (locked)</text></g><g class="message" data-participant-1="API" data-participant-2="API"><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="357.1016" y1="350.082" y2="350.082"/><line style="stroke:#181818;stroke-width:1;" x1="357.1016" x2="357.1016" y1="350.082" y2="363.082"/><line style="stroke:#181818;stroke-width:1;" x1="316.1016" x2="357.1016" y1="363.082" y2="363.082"/><polygon fill="#181818" points="326.1016,359.082,316.1016,363.082,326.1016,367.082,322.1016,363.082" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54.7739" x="362.8376" y="299.4082">Validate:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.3687" x="345.5403" y="314.7188">- Book exists?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.2461" x="322.1016" y="330.0293">- Codes format valid?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.3398" x="338.5547" y="345.3398">- No duplicates?</text></g><path d="M10,378.082 L72.1387,378.082 L72.1387,385.3926 L62.1387,395.3926 L10,395.3926 L10,378.082" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="275.3711" style="stroke:#000000;stroke-width:1.5;" width="711.54" x="10" y="378.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="25" y="391.6504">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="102.7974" x="87.1387" y="390.7168">[Validation Failed]</text><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="472.958,412.7031,482.958,416.7031,472.958,420.7031,476.958,416.7031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="478.958" y1="416.7031" y2="416.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.1108" x="366.9744" y="411.9609">ROLLBACK</text></g><g class="message" data-participant-1="API" data-participant-2="Admin"><polygon fill="#181818" points="56.1382,442.0137,46.1382,446.0137,56.1382,450.0137,52.1382,446.0137" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="50.1382" x2="304.1016" y1="446.0137" y2="446.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.7192" x="113.7603" y="441.2715">400/404/409 Error</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="721.54" y1="455.0137" y2="455.0137"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108.5122" x="15" y="465.6484">[Validation Passed]</text><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="472.958,512.2451,482.958,516.2451,472.958,520.2451,476.958,516.2451" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="478.958" y1="516.2451" y2="516.2451"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="86.3091" x="328.0315" y="496.1924">BULK INSERT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.5742" x="418.4539" y="496.1924">coupons</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.1719" x="335.9438" y="511.5029">state='UNASSIGNED'</text></g><path d="M499,473.9688 L499,528.9688 L710,528.9688 L710,483.9688 L700,473.9688 L499,473.9688" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M700,473.9688 L700,483.9688 L710,483.9688 L700,473.9688" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.4658" x="505" y="491.5371">Single query for all codes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.7402" x="505" y="506.8477">Much faster than N inserts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.582" x="505" y="522.1582">(100 codes: 50ms vs 5000ms)</text><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="472.958,567.5215,482.958,571.5215,472.958,575.5215,476.958,571.5215" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="478.958" y1="571.5215" y2="571.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.0298" x="357.0149" y="551.4688">UPDATE book</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.8564" x="327.1016" y="566.7793">total_code_count += N</text></g><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="477.958,596.832,487.958,600.832,477.958,604.832,481.958,600.832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="315.1016" x2="483.958" y1="600.832" y2="600.832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.4536" x="375.803" y="596.0898">COMMIT</text></g><g class="message" data-participant-1="API" data-participant-2="Admin"><polygon fill="#181818" points="56.1382,641.4531,46.1382,645.4531,56.1382,649.4531,52.1382,645.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="50.1382" x2="304.1016" y1="645.4531" y2="645.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.7969" x="136.2214" y="625.4004">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.8716" x="107.1841" y="640.7109">{count: N, codes: [...]}</text></g><path d="M17,665.4531 L17,766.4531 L516,766.4531 L516,675.4531 L506,665.4531 L17,665.4531" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M506,665.4531 L506,675.4531 L516,675.4531 L506,665.4531" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164.1694" x="134.1194" y="683.0215">Key Points for Interview:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.3335" x="134.1194" y="698.332">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97.8872" x="150.5662" y="698.332">Bulk operation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.3115" x="252.5667" y="698.332">for performance</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.3335" x="134.1194" y="713.6426">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67.7739" x="150.5662" y="713.6426">Validation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.7422" x="222.4534" y="713.6426">before insert</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.3335" x="134.1194" y="728.9531">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126.7881" x="150.5662" y="728.9531">Atomic transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.5962" x="281.4675" y="728.9531">(all or nothing)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.3335" x="134.1194" y="744.2637">4.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130.019" x="150.5662" y="744.2637">Duplicate detection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.4727" x="284.6985" y="744.2637">(globally unique)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.9585" x="134.1194" y="759.5742">5. Alternative to auto-generation</text><!--SRC=[RLHTRzem57tthxXY3wLPWT3HXo5rLGZfXWe14TXBcIgJk61XR6OxR5NL_xvhyrcj88W_phtt-9xZc1MN6whf6kOqNosqAcKHAw4qVBfFt9UO8yAmtoMJEHimO-Y2HO8l9EHCMgO9iTmA1jEDKBI0k3HMhI5M1OC-DnQgF_XYMUkpBHENXD3SOe6eM7D9CBNbETzGQQ4IZNeLe0RmIGfgwPmQ1fNkVkItkXr2V2JKlZaSj64qp2RGc2krCerNztZYnLiZn-AcKNf2C_dgfsruhCJ3RjAiN84VNEEWNg__UdES-9PQvciJbnZpTpkOlfDyxwKm6KTf5iMJtZ0zOJsPCsYMz9Du0ex3J0R1_N0Cqr4tcYH1GAJ208rji0IWh_ALXu5LiD7O5-cMSoNpKckSm8wu8KmMu489mGgruvaxBhOgC0qhBeyaTdi_gU3OFTQUoTeEoFwY2EREpPqc1fwLNbCBMuVqowc20alo7EFC7Keax24FLnBkAHUiG8O0v-ST3_lzJXG_d3OS2QzE6rfXs6Y5BVnzXKHhfGaJAETPrX4rveEiGT2PzX-WbsR9U184s9LoewIPIMEHtUt5D8sohFSzJReNFlPTPzqdutA1PaItwXTtLA12W3V07Z0eyoKyKuFE1Rka4bBWqZ1j3u1gCmnXRvcRS6rWQ_0PukZI8uwgkCb_1zXflhU1LPQA9vSB_qfKzlCjf1_7nSF1e3VnomKxDzbxz5cFhyCcn9eXRETnpD-6zEf0_N7dRMHBpX9wX_kcgItRtyEhNPaWU60lC59SMcyIwBdRlUNiJnij3D2iEtLAiGArOTghY08v84wzgV3zWBXhXpifZPWvmsssRpCYlZX4X6y9deFLL1f7poEhJYtCY0oNAAHhUCk1kmT_OdCiEw8NGiqnuWLAoL5n1x-fGoIGjyJYM-Qk62sjgYsOt7C-tQf_]--></g></svg>